<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <style type="text/css">
    html,
    body,
    .mymap {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
    }
  </style>
<!--Bootstrap-->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<!--Leaflet-->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
<!--  Military symbols-->
  <script src="node_modules/milsymbol/dist/milsymbol.js"></script>
  <script src="situation.json"></script>
</head>

<body onload="init()">
  <script>
    function init() {
      var osmAttr = '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>';
      var OSM = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 18, attribution: osmAttr }),
        latlng = L.latLng(59, 16);
      window.map = L.map('map', { center: latlng, zoom: 5, layers: [OSM] });
      window.map.on('dblclick', onMapClick);
      window.map.doubleClickZoom.disable();
      var iconSize = {
        "Team/Crew": 5,
        "Squad": 10,
        "Section": 15,
        "Platoon/detachment": 20,
        "Company/battery/troop": 25,
        "Battalion/squadron": 30,
        "Regiment/group": 35,
        "Brigade": 40,
        "Division": 45,
        "Corps/MEF": 50,
        "Army": 55,
        "Army Group/front": 60,
        "Region/Theater": 65,
        "Command": 70
      };

      L.geoJson(situation, {
        pointToLayer: function (feature, latlng) {

          var mysymbol = new ms.Symbol(
            feature.properties.SIDC, {
              uniqueDesignation: feature.properties.name
            })
          // Now that we have a symbol we can ask for the echelon and set the symbol size
          mysymbol = mysymbol.setOptions({ size: iconSize[mysymbol.getMetadata().echelon] });

          var myicon = L.icon({
            iconUrl: mysymbol.toDataURL(),
            iconAnchor: [mysymbol.getAnchor().x, mysymbol.getAnchor().y],
          });

          return L.marker(latlng, { icon: myicon, draggable: true });
        }
      }).addTo(map);
    }

    //Get lat, lon where user was clicked
    let clickedPos;
    onMapClick = e => {
      $('#createModal').modal('toggle');
      clickedPos = e.latlng;

    };

    //method for add marker into map. Require 3 arguments. SIDC looks like "EAFP--------"
    addMarker = (SIDC, name, latlng) => {
      let mysymbol = new ms.Symbol(
              SIDC, {
                uniqueDesignation: name
              });
      // Now that we have a symbol we can ask for the echelon and set the symbol size
      mysymbol = mysymbol.setOptions({ size: 25 });

      const myicon = L.icon({
        iconUrl: mysymbol.toDataURL(),
        iconAnchor: [mysymbol.getAnchor().x, mysymbol.getAnchor().y],
      });

      return L.marker(latlng, { icon: myicon, draggable: true }).addTo(map);
    };

    symbolSet = {
      stdIdentity1: {
        '100': 'Reality',
        '101': 'Exercise',
        '102': 'Simulation',
      },
      stdIdentity2: {
        '0': 'Pending',
        '1': 'Unknown',
        '2': 'Assumed friend',
        '3': 'Friend',
        '4': 'Neutral',
        '5': 'Suspect/Joker',
        '6': 'Hostile/Faker',
      },
      symbol: {
        '01': 'Air',
        '02': 'Air missile',
        '05': 'Space',
        '10': 'Land unit',
        '11': 'Land civilian unit/Organization',
        '15': 'Equipment',
        '20': 'Land installations',
        '25': 'Control meassure',
        '27': 'Dismounted individual',
        '30': 'Sea surface',
      },
      status: {
        '0': 'Present',
        '1': 'Planned/Suspect',
        '2': 'Present/Fully capable',
        '3': 'Present/Damaged',
        '4': 'Present/Destroyed',
        '5': 'Present/Full to capacity'
      },
      head: {
        '0': 'Present',
        '1': 'Planned/Suspect',
        '2': 'Present/Fully capable',
        '3': 'Present/Damaged',
        '4': 'Present/Destroyed',
        '5': 'Present/Full to capacity',
        '6': 'Task Forse Headquarters',
        '7': 'Feint/Dummy Task Forse Headqurters'
      }

    };

    var SIDC, stdIdentity1, stdIdentity2, symbol, status, head = '0';
	

    handleIdentity1 = value => {
      stdIdentity1 = value;
      const stdIdentity1Dropdown = document.getElementById('stdIdentity1-dropdown');
      stdIdentity1Dropdown.innerText = symbolSet['stdIdentity1'][stdIdentity1];
      imageReload();
    };

    handleIdentity2 = value => {
      stdIdentity2 = value;
      const stdIdentity2Dropdown = document.getElementById('stdIdentity2-dropdown');
      stdIdentity2Dropdown.innerText = symbolSet['stdIdentity2'][stdIdentity2];
      imageReload();
    };

    handleStatus = value => {
      status = value;
      const statusDropdown = document.getElementById('status-dropdown');
      statusDropdown.innerText = symbolSet['status'][status];
      imageReload();
    };

    handleSymbol = value => {
      symbol = value;
      const symbolDropdown = document.getElementById('symbol-dropdown');
      symbolDropdown.innerText = symbolSet['symbol'][symbol];
      imageReload();
    };

    handleHead = value => {
      head = value;
      const symbolDropdown = document.getElementById('head-dropdown');
      symbolDropdown.innerText = symbolSet['head'][head];
      imageReload();
    };
    
    submitFormCreate = () => {
      const name = document.getElementById('name').value;
      $('#createModal').modal('toggle');
      addMarker(SIDC, name, clickedPos)
    };

    imageReload = () => {
      const imgPreview = document.getElementById('preview-img');
      SIDC = (stdIdentity1 || '000') + (stdIdentity2 || '0') + (symbol || '00') + (status || '0')+head;
      renderedContent = new ms.Symbol(SIDC, { size: 50}).asSVG();
      imgPreview.innerHTML = renderedContent + `<div>Code ${SIDC}</div>`;
    }
  </script>

<!--  <div id="map" class="mymap" data-toggle="modal" data-target="#createModal"></div>-->
  <div id="map" class="mymap""></div>

  <!-- Modal -->
  <div class="modal fade" id="createModal" role="dialog">
    <div class="modal-dialog">

      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Create marker</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <div id="preview-img" class="text-center"></div>
          <form>
            <div class="form-group">
              <label for="name">Name</label>
              <div>
                <input type="text" class="form-control" id="name" aria-describedby="basic-addon3">
              </div>
            </div>
<!--            stdIdentity1-->
            <div class="dropdown mb-3 text-center">
              <button class="btn btn-secondary dropdown-toggle w-75" type="button" id="stdIdentity1-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Standard identity 1
              </button>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="dropdown-item" href="#" onclick="handleIdentity1('100')">Reality</a>
                <a class="dropdown-item" href="#" onclick="handleIdentity1('101')">Exercise</a>
                <a class="dropdown-item" href="#" onclick="handleIdentity1('102')">Simulation</a>
              </div>
             </div>
            <div class="dropdown mb-3 text-center">
              <button class="btn btn-secondary dropdown-toggle w-75" type="button" id="stdIdentity2-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Standard identity 2
              </button>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="dropdown-item" href="#" onclick="handleIdentity2('0')">Pending</a>
                <a class="dropdown-item" href="#" onclick="handleIdentity2('1')">Unknown</a>
                <a class="dropdown-item" href="#" onclick="handleIdentity2('2')">Assumed friend</a>
                <a class="dropdown-item" href="#" onclick="handleIdentity2('3')">Friend</a>
                <a class="dropdown-item" href="#" onclick="handleIdentity2('4')">Neutral</a>
                <a class="dropdown-item" href="#" onclick="handleIdentity2('5')">Suspect/Joker</a>
                <a class="dropdown-item" href="#" onclick="handleIdentity2('6')">Hostile/Faker</a>
              </div>
            </div>
            <div class="dropdown mb-3 text-center">
              <button class="btn btn-secondary dropdown-toggle w-75" type="button" id="symbol-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Symbol set
              </button>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="dropdown-item" href="#" onclick="handleSymbol('01')">Air</a>
                <a class="dropdown-item" href="#" onclick="handleSymbol('02')">Air missile</a>
                <a class="dropdown-item" href="#" onclick="handleSymbol('05')">Space</a>
                <a class="dropdown-item" href="#" onclick="handleSymbol('10')">Land unit</a>
                <a class="dropdown-item" href="#" onclick="handleSymbol('11')">Land civilian unit/Organization</a>
                <a class="dropdown-item" href="#" onclick="handleSymbol('15')">Equipment</a>
                <a class="dropdown-item" href="#" onclick="handleSymbol('20')">Land installations</a>
                <a class="dropdown-item" href="#" onclick="handleSymbol('25')">Control meassure</a>
                <a class="dropdown-item" href="#" onclick="handleSymbol('27')">Dismounted individual</a>
                <a class="dropdown-item" href="#" onclick="handleSymbol('30')">Sea surface</a>
              </div>
            </div>
            <div class="dropdown mb-3 text-center">
              <button class="btn btn-secondary dropdown-toggle w-75" type="button" id="status-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Status
              </button>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="dropdown-item" href="#" onclick="handleStatus('0')">Present</a>
                <a class="dropdown-item" href="#" onclick="handleStatus('1')">Planned/Suspect</a>
                <a class="dropdown-item" href="#" onclick="handleStatus('2')">Present/Fully capable</a>
                <a class="dropdown-item" href="#" onclick="handleStatus('3')">Present/Damaged</a>
                <a class="dropdown-item" href="#" onclick="handleStatus('4')">Present/Destroyed</a>
                <a class="dropdown-item" href="#" onclick="handleStatus('5')">Present/Full to capacity</a>
              </div>
            </div>

            <div class="dropdown mb-3 text-center">
              <button class="btn btn-secondary dropdown-toggle w-75" type="button" id="head-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Headquarters/Task force/Dummy
              </button>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="dropdown-item" href="#" onclick="handleHead('0')">Not Applicable</a>
                <a class="dropdown-item" href="#" onclick="handleHead('1')">Feint/Dummy</a>
                <a class="dropdown-item" href="#" onclick="handleHead('2')">Headquarters</a>
                <a class="dropdown-item" href="#" onclick="handleHead('3')">Feint/Dummy Headquarters</a>
                <a class="dropdown-item" href="#" onclick="handleHead('4')">Task Forse</a>
                <a class="dropdown-item" href="#" onclick="handleHead('5')">Feint/Dummy Task Forse</a>
                <a class="dropdown-item" href="#" onclick="handleHead('6')">Task Forse Headquarters</a>
                <a class="dropdown-item" href="#" onclick="handleHead('7')">Feint/Dummy Task Forse Headqurters</a>
              </div>
            </div>
           
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="submitFormCreate()">Save changes</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>

    </div>
  </div>

</body>

</html>

